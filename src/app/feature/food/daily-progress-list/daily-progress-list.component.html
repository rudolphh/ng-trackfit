<!-- progress bar -->
<app-progress-bar
  [percent]="percentOfDaily"
  [remaining]="remainingCalories"
></app-progress-bar>

<div class="float-left mt-2">
  Remaining :
  <!-- <span class="light-text-info">{{ remainingCalories }}</span> -->
  <span [ngClass]="remainingColor()">{{ remainingCalories }}</span>
</div>

<!-- select all -->
<div class="d-flex mt-2" style="height: 51px">
  <app-select-all
    *ngIf="listLength > 1"
    class="ml-auto"
    [anySelected]="anySelected()"
    (delete)="deleteSelected()"
    (selectAll)="selectAllChange()"
    [allSelected]="allFoodsSelected"
  ></app-select-all>
</div>

<!-- start foods list divider -->
<mat-divider class="mt-2 mb-3"></mat-divider>

<div *ngIf="listLength === 0" class="d-flex justify-content-center my-4">
  <span class="d-flex align-items-center">
    <i
      class="fas fa-exclamation-circle text-success mx-2"
      style="font-size: 1.5em"
    ></i>
    No food today
  </span>
</div>

<form [formGroup]="foodsForm">
  <mat-selection-list #foodsSelect id="food-selection-list">
    <div
      formArrayName="foods"
      *ngFor="
        let food of foodsFormArray.controls.slice(0, maxFoodsDisplayed);
        let i = index
      "
    >
      <ng-container
        *ngIf="{
          isHidden: true
        } as locals"
      >
        <div
          [formGroupName]="i"
          class="d-flex flex-column"
          style="max-height: 134px"
        >
          <div class="d-flex justify-content-between">
            <span class="mr-2">
              <mat-form-field style="max-width: 90px" appearance="fill">
                <mat-label>Time</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  formControlName="time"
                  type="time"
                  matInput
                  name="time-{{ i }}"
                />
              </mat-form-field>
            </span>

            <span class="flex-grow-1" style="min-width: 0">
              <mat-form-field class="w-100" appearance="fill">
                <mat-label>Food</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  (keydown)="$event.stopPropagation()"
                  formControlName="name"
                  matInput
                  name="name-{{ i }}"
                  placeholder="Ex. Pizza"
                />
              </mat-form-field>
            </span>

            <span class="ml-2">
              <mat-form-field style="max-width: 90px" appearance="fill">
                <mat-label>Calories</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  formControlName="calories"
                  appNumbersOnly
                  matInput
                  name="calories-{{ i }}"
                  maxLength="4"
                  placeholder="250"
                />
              </mat-form-field>
            </span>

            <mat-list-option
              style="height: 51px"
              color="warn"
              class="ml-2"
              (click)="optionClick()"
              [value]="food"
            >
            </mat-list-option>
          </div>

          <!-- macro inputs -->
          <div class="d-flex" style="position: relative; bottom: 5px"
            [ngStyle]="{ 'height': locals.isHidden ? 0 : '100%' }"
          >
            <span style="max-width: 33%">
              <!-- calorie input -->
              <mat-form-field
                appearance="outline"
                class="text-center w-100"
                [ngClass]="{ 'cdk-visually-hidden': locals.isHidden }"
              >
              <mat-label>Protein</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  matInput
                  maxLength="4"
                  formControlName="protein"
                  appNumbersOnly
                />
              </mat-form-field>
              <!-- end calorie input -->
            </span>

            <span class="ml-2" style="max-width: 33%">
              <!-- calorie input -->
              <mat-form-field
                appearance="outline"
                class="text-center w-100"
                [ngClass]="{ 'cdk-visually-hidden': locals.isHidden }"
              >
                <mat-label>Carbs</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  matInput
                  maxLength="4"
                  formControlName="carbs"
                  appNumbersOnly
                />
              </mat-form-field>
              <!-- end calorie input -->
            </span>

            <span class="ml-2" style="max-width: 31%">
              <!-- calorie input -->
              <mat-form-field
                appearance="outline"
                class="text-center w-100"
                [ngClass]="{ 'cdk-visually-hidden': locals.isHidden }"
              >
                <mat-label>Fats</mat-label>
                <input
                  (focus)="onFocusEvent($event, locals)"
                  (blur)="onBlurEvent($event, locals)"
                  matInput
                  maxLength="4"
                  formControlName="fats"
                  appNumbersOnly
                />
              </mat-form-field>
              <!-- end calorie input -->
            </span>
          </div>
        </div>
      </ng-container>
    </div>
  </mat-selection-list>
</form>

<!-- end foods list -->
<mat-divider class="mb-2"></mat-divider>

<span class="d-flex mt-3">
  <button
    mat-flat-button
    *ngIf="listLength > 3 && listLength > maxFoodsDisplayed"
    (click)="loadMore()"
    class="
      w-100
      d-flex
      justify-content-center
      align-items-center
      bg-transparent
    "
    style="height: 51px; color: lightgrey"
  >
    <span>load</span>
    <i class="fas fa-arrow-circle-down mx-2"></i>
    <span>more</span>
  </button>

  <button
    mat-flat-button
    *ngIf="maxFoodsDisplayed > 3"
    (click)="loadReset()"
    class="bg-transparent ml-auto light-text-success"
    style="height: 51px"
  >
    <i
      class="far fa-2x fa-minus-square"
      matTooltip="Show Less"
      matTooltipPosition="left"
      matTooltipShowDelay="500"
      matTooltipHideDelay="1000"
    ></i>
  </button>
</span>
